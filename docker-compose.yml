services:
  napcat:
    image: mlikiowa/napcat-docker:latest
    container_name: napcat
    environment:
      - NAPCAT_UID=${NAPCAT_UID:-1000}
      - NAPCAT_GID=${NAPCAT_GID:-1000}
      - TZ=Asia/Shanghai
    ports:
      - "6099:6099"   # NapCat WebUI
      - "3000:3000"
      - "3001:3001"
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./napcat/qq:/app/.config/QQ
      - ./napcat/config:/app/napcat/config
    restart: unless-stopped
  
  nonebot:
    image: ${NONEBOT_IMAGE:-qqbot-nonebot:local}
    build:
      context: ./bot
    container_name: nonebot
    working_dir: /app
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./bot:/app
      # 记忆/状态数据库（SQLite），单独挂载保证容器重建不丢
      - ./bot/plugins/companion_core/data.db:/app/plugins/companion_core/data.db
    extra_hosts:
      # 让容器能访问宿主机代理（Linux 下默认没有 host.docker.internal）
      - "host.docker.internal:host-gateway"
    env_file:
      - ./bot/.env
    environment:
      - ONEBOT_ACCESS_TOKEN=mybot_2026_token
      - ENVIRONMENT=prod
      - HOST=0.0.0.0
      - PORT=8080
      - TZ=Asia/Shanghai
    ports:
      - "8080:8080"
    command: ["python", "bot.py"]
    restart: unless-stopped
    
    
    # 语音已切到 DashScope（ASR/TTS），不再依赖 GPT-SoVITS
